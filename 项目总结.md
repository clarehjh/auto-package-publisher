# 自动化包发布工具 - 项目总结

## 🎯 项目概述

这是一个功能完整的 Web 应用，用于自动化发布组件包和插件包到 NPM 平台。提供了友好的 Web 界面，只需上传包文件即可实现一键发布。

## 📁 项目结构

```
自动化打包/
├── public/                    # 前端文件目录
│   ├── index.html            # 主页面（上传界面）
│   ├── style.css             # 样式文件
│   └── app.js                # 前端JavaScript逻辑
├── scripts/                   # 后端脚本目录
│   ├── npm-publisher.js      # NPM发布脚本
│   └── package-processor.js  # 包处理脚本
├── server.js                  # Express服务器主文件
├── package.json               # 项目配置和依赖
├── env.example                # 环境变量示例
├── .gitignore                 # Git忽略文件配置
├── start.bat                  # Windows启动脚本
├── start.sh                   # Linux/Mac启动脚本
├── README.md                  # 项目文档
├── 使用说明.md                # 中文使用指南
└── 项目总结.md                # 本文档
```

## 🛠️ 技术栈

- **后端框架**: Express.js
- **前端**: 原生 HTML/CSS/JavaScript
- **文件上传**: Multer
- **包处理**: Archiver, fs-extra
- **发布工具**:
  - NPM CLI
- **环境管理**: dotenv

## ✨ 核心功能

### 1. Web 上传界面

- 美观的现代化 UI 设计
- 拖拽/点击上传文件
- 实时状态反馈
- 详细的发布结果展示

### 2. NPM 发布

- 自动发布到 NPM 官方仓库
- 支持自定义 registry
- 版本冲突检测
- Token 安全管理

### 4. 包处理

- 自动检测文件类型
- 支持.tgz 和.zip 格式
- 自动创建/更新 package.json
- 包结构验证

## 🚀 快速开始

### 1. 安装

```bash
npm install
```

### 2. 配置

```bash
# 复制环境变量文件
cp env.example .env

# 编辑.env，填入你的token
```

### 3. 启动

```bash
npm start
# 或
# Windows: 双击 start.bat
# Linux/Mac: ./start.sh
```

### 4. 访问

```
http://localhost:3000
```

## 🔧 配置说明

### NPM Token 配置

1. 访问：https://www.npmjs.com/settings
2. 进入 Access Tokens
3. 创建 Automation 或 Publish token
4. 复制 token 到 `.env` 文件

## 📦 使用流程

1. **准备包文件** - 确保包含 package.json（已打包或源文件）
2. **上传文件** - 在 Web 界面上选择文件
3. **填写信息** - 包名、版本号、发布选项
4. **发布** - 点击"开始发布"按钮
5. **查看结果** - 查看发布状态和结果链接

## 🌐 服务器部署

### 使用 PM2

```bash
npm install -g pm2
pm2 start server.js --name "package-publisher"
pm2 startup
pm2 save
```

### 使用 Nginx

配置反向代理到本地 3000 端口

### 使用 Docker

```bash
docker build -t package-publisher .
docker run -d -p 3000:3000 --env-file .env package-publisher
```

## 🔐 安全建议

1. **保护 Token** - 不要将.env 文件提交到 Git
2. **使用 HTTPS** - 生产环境强制使用 HTTPS
3. **设置防火墙** - 限制访问 IP
4. **定期轮换 Token** - 定期更新访问令牌
5. **日志记录** - 启用详细的日志记录
6. **限流控制** - 防止恶意滥用

## 📝 API 接口

### POST /api/upload

上传包文件并发布

**请求参数**:

- package (file): 包文件
- packageName (string): 包名称
- version (string): 版本号
- publishNPM (boolean): 是否发布到 NPM
- githubRepo (string): GitHub 仓库（用于 package.json 的 repository 字段）
- npmToken (string): NPM token（可选）

**响应**:

```json
{
  "success": true,
  "uploadId": "xxx",
  "results": {
    "npm": { "success": true, "message": "发布成功" }
  }
}
```

### GET /api/health

健康检查接口

## 🐛 故障排除

### NPM 发布失败

- 检查 token 是否正确
- 确认包名符合规范
- 检查版本号是否已存在

### GitHub 发布失败

- 确认 token 权限正确
- 检查仓库名称格式
- 确认仓库存在并有访问权限

### 文件上传失败

- 检查文件大小（限制 100MB）
- 确认文件格式支持
- 检查磁盘空间

## 📈 扩展功能建议

1. **历史记录** - 保存发布历史
2. **用户认证** - 添加登录系统
3. **批量发布** - 支持批量上传
4. **自动版本** - 自动递增版本号
5. **CI/CD 集成** - 与 GitHub Actions 集成
6. **通知系统** - 发布成功/失败通知
7. **统计面板** - 发布统计和分析

## 👥 贡献

欢迎提交 Issue 和 Pull Request 来改进这个项目！

## 📄 许可证

MIT License

## 📞 支持

如有问题，请查看：

- README.md - 详细文档
- 使用说明.md - 中文使用指南
- 项目 Issues - 问题反馈

---

**感谢使用！** 🎉
